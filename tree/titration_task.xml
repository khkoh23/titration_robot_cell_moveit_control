<?xml version="1.0" encoding="UTF-8"?>
<root BTCPP_format="4"
      main_tree_to_execute="titration_task">
  <BehaviorTree ID="MoveDispense">
    <Sequence>
      <MovePose name="MovePoseB1"
                position_x="0.225"
                position_y="0.200"
                position_z="1.100"/>
      <MovePose name="MovePoseB2"
                position_x="0.225"
                position_y="0.200"
                position_z="1.000"/>
      <ReactiveFallback>
        <IsTitrationDone/>
        <IsPipetteEmpty/>
        <DispenseStepVolume/>
      </ReactiveFallback>
      <MovePose name="MovePoseB1"
                position_x="0.225"
                position_y="0.200"
                position_z="1.100"/>
    </Sequence>
  </BehaviorTree>

  <BehaviorTree ID="ReplenishPipette">
    <Sequence>
      <MovePose name="MovePoseA1"
                position_x="0.225"
                position_y="-0.225"
                position_z="1.100"/>
      <MovePose name="MovePoseA2"
                position_x="0.225"
                position_y="-0.225"
                position_z="0.860"/>
      <Aspire/>
      <MovePose name="MovePoseA1"
                position_x="0.225"
                position_y="-0.225"
                position_z="1.100"/>
    </Sequence>
  </BehaviorTree>

  <BehaviorTree ID="titration_task">
    <Sequence name="TitrationTask">
      <Fallback>
        <IsStateNormal/>
        <MoveState name="MoveStateNormal"
                   group_state="normal"/>
      </Fallback>
      <Fallback>
        <IsTitrationDone/>
        <SubTree ID="ReplenishPipette"/>
      </Fallback>
      <Fallback>
        <IsTitrationDone/>
        <SubTree ID="MoveDispense"/>
      </Fallback>
      <Fallback>
        <IsTitrationDone/>
        <Sequence>
          <MoveState name="MoveStateNormal"
                     group_state="normal"/>
        </Sequence>
      </Fallback>
    </Sequence>
  </BehaviorTree>

  <!-- Description of Node Models (used by Groot) -->
  <TreeNodesModel>
    <Action ID="Aspire"
            editable="true"/>
    <Action ID="DispenseStepVolume"
            editable="true"/>
    <Condition ID="IsPipetteEmpty"
               editable="true"/>
    <Condition ID="IsStateNormal"
               editable="true"/>
    <Condition ID="IsTitrationDone"
               editable="true"/>
    <Action ID="MovePose"
            editable="true">
      <input_port name="position_x"/>
      <input_port name="position_y"/>
      <input_port name="position_z"/>
    </Action>
    <Action ID="MoveState"
            editable="true">
      <input_port name="group_state"/>
    </Action>
  </TreeNodesModel>

</root>
